2025-09-13 14:41:27 [main] INFO  c.b.w.WhatsappAiBackendApplication - Starting WhatsappAiBackendApplication v1.0.0 using Java 21.0.7 with PID 2523 (/workspace/target/whatsapp-ai-backend-1.0.0.jar started by ubuntu in /workspace)
2025-09-13 14:41:27 [main] DEBUG c.b.w.WhatsappAiBackendApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-09-13 14:41:27 [main] INFO  c.b.w.WhatsappAiBackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-13 14:41:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-13 14:41:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 98 ms. Found 3 JPA repository interfaces.
2025-09-13 14:41:29 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-13 14:41:29 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-13 14:41:29 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-09-13 14:41:29 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-13 14:41:29 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1410 ms
2025-09-13 14:41:29 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dataSourceScriptDatabaseInitializer' defined in class path resource [org/springframework/boot/autoconfigure/sql/init/DataSourceInitializationConfiguration.class]: Unsatisfied dependency expressed through method 'dataSourceScriptDatabaseInitializer' parameter 0: Error creating bean with name 'dataSource' defined in class path resource [org/springframework/boot/autoconfigure/jdbc/DataSourceConfiguration$Hikari.class]: Failed to instantiate [com.zaxxer.hikari.HikariDataSource]: Factory method 'dataSource' threw exception with message: Cannot load driver class: org.h2.Driver
2025-09-13 14:41:29 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-13 14:41:29 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-13 14:41:29 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dataSourceScriptDatabaseInitializer' defined in class path resource [org/springframework/boot/autoconfigure/sql/init/DataSourceInitializationConfiguration.class]: Unsatisfied dependency expressed through method 'dataSourceScriptDatabaseInitializer' parameter 0: Error creating bean with name 'dataSource' defined in class path resource [org/springframework/boot/autoconfigure/jdbc/DataSourceConfiguration$Hikari.class]: Failed to instantiate [com.zaxxer.hikari.HikariDataSource]: Factory method 'dataSource' threw exception with message: Cannot load driver class: org.h2.Driver
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:802)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:546)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1336)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1166)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:312)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.bakchodai.whatsapp.WhatsappAiBackendApplication.main(WhatsappAiBackendApplication.java:20)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [org/springframework/boot/autoconfigure/jdbc/DataSourceConfiguration$Hikari.class]: Failed to instantiate [com.zaxxer.hikari.HikariDataSource]: Factory method 'dataSource' threw exception with message: Cannot load driver class: org.h2.Driver
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:655)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:643)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1336)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1166)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1441)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1348)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:911)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:789)
	... 26 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.zaxxer.hikari.HikariDataSource]: Factory method 'dataSource' threw exception with message: Cannot load driver class: org.h2.Driver
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:178)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:651)
	... 40 common frames omitted
Caused by: java.lang.IllegalStateException: Cannot load driver class: org.h2.Driver
	at org.springframework.util.Assert.state(Assert.java:97)
	at org.springframework.boot.autoconfigure.jdbc.DataSourceProperties.determineDriverClassName(DataSourceProperties.java:175)
	at org.springframework.boot.autoconfigure.jdbc.PropertiesJdbcConnectionDetails.getDriverClassName(PropertiesJdbcConnectionDetails.java:49)
	at org.springframework.boot.autoconfigure.jdbc.DataSourceConfiguration.createDataSource(DataSourceConfiguration.java:55)
	at org.springframework.boot.autoconfigure.jdbc.DataSourceConfiguration$Hikari.dataSource(DataSourceConfiguration.java:117)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:140)
	... 41 common frames omitted
2025-09-13 14:43:09 [main] INFO  c.b.w.WhatsappAiBackendApplication - Starting WhatsappAiBackendApplication v1.0.0 using Java 21.0.7 with PID 2767 (/workspace/target/whatsapp-ai-backend-1.0.0.jar started by ubuntu in /workspace)
2025-09-13 14:43:09 [main] DEBUG c.b.w.WhatsappAiBackendApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-09-13 14:43:09 [main] INFO  c.b.w.WhatsappAiBackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-13 14:43:10 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-13 14:43:10 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 91 ms. Found 3 JPA repository interfaces.
2025-09-13 14:43:11 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-13 14:43:11 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-13 14:43:11 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-09-13 14:43:11 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-13 14:43:11 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1357 ms
2025-09-13 14:43:11 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-13 14:43:11 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-09-13 14:43:11 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-13 14:43:11 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-13 14:43:11 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-13 14:43:11 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb user=SA
2025-09-13 14:43:11 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-13 14:43:11 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-09-13 14:43:12 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    create table characters (
        id uuid not null,
        avatar_url varchar(500),
        background TEXT,
        created_at timestamp(6) not null,
        is_active boolean not null,
        name varchar(255) not null,
        personality_traits TEXT,
        speaking_style varchar(1000),
        system_prompt TEXT,
        updated_at timestamp(6),
        primary key (id)
    )
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    create table group_members (
        id uuid not null,
        is_active boolean not null,
        joined_at timestamp(6) not null,
        character_id uuid not null,
        group_id uuid not null,
        primary key (id)
    )
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    create table groups (
        id uuid not null,
        created_at timestamp(6) not null,
        description varchar(1000),
        is_active boolean not null,
        name varchar(255) not null,
        updated_at timestamp(6),
        primary key (id)
    )
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    create table messages (
        id uuid not null,
        content TEXT not null,
        is_ai_generated boolean not null,
        message_type varchar(255) not null check (message_type in ('TEXT','IMAGE','AUDIO','VIDEO','DOCUMENT','EMOJI','SYSTEM')),
        response_time_ms bigint,
        timestamp timestamp(6) not null,
        character_id uuid not null,
        group_id uuid not null,
        primary key (id)
    )
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    alter table if exists group_members 
       add constraint FKs4g77iuoqgrletr6hva3sxrv 
       foreign key (character_id) 
       references characters
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    alter table if exists group_members 
       add constraint FKkv9vlrye4rmhqjq4qohy2n5a6 
       foreign key (group_id) 
       references groups
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    alter table if exists messages 
       add constraint FKsieokekcgi9yij6u7yil5u7p9 
       foreign key (character_id) 
       references characters
2025-09-13 14:43:12 [main] DEBUG org.hibernate.SQL - 
    alter table if exists messages 
       add constraint FK2cpth2c6q2d75e9ppqyc402t 
       foreign key (group_id) 
       references groups
2025-09-13 14:43:12 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-13 14:43:12 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-09-13 14:43:13 [main] INFO  c.b.w.service.ConversationEngine - Initialized ConversationEngine with 1 AI connectors
2025-09-13 14:43:13 [main] INFO  c.b.w.websocket.ChatWebSocketHandler - ChatWebSocketHandler initialized (WebSocket functionality disabled)
2025-09-13 14:43:13 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-13 14:43:13 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-09-13 14:43:13 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@239c4792, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@598acf89, org.springframework.security.web.context.SecurityContextHolderFilter@17ab4ba5, org.springframework.security.web.header.HeaderWriterFilter@3a95fd1c, org.springframework.web.filter.CorsFilter@150ba838, org.springframework.security.web.csrf.CsrfFilter@5d7b3a93, org.springframework.security.web.authentication.logout.LogoutFilter@79ed43f8, org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@4d500865, org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@2640893e, org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@198b4fb6, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@12bc9450, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@434d5eb9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@646a5e76, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@58ea2bc2, org.springframework.security.web.access.ExceptionTranslationFilter@37d05d32, org.springframework.security.web.access.intercept.AuthorizationFilter@10eddc8b]
2025-09-13 14:43:13 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-09-13 14:43:13 [main] INFO  c.b.w.WhatsappAiBackendApplication - Started WhatsappAiBackendApplication in 4.561 seconds (process running for 4.898)
2025-09-13 14:43:40 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-13 14:43:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-13 14:43:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-09-13 14:43:40 [http-nio-8080-exec-1] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/actuator/health' (previous null). Performing CorsConfiguration lookup. This is logged once only at WARN level, and every time at TRACE.
